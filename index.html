<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏á‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: sans-serif; padding:20px; background:#f9f9f9; text-align:center; }
h2 { margin-bottom:20px; }
table { border-collapse: collapse; width:100%; max-width:800px; margin:0 auto; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
th, td { border:1px solid #ddd; padding:8px 12px; text-align:center; }
th { background:#4CAF50; color:white; }
tr:nth-child(even) { background:#f2f2f2; }
input.filter { width:90%; padding:4px; font-size:12px; margin-top:4px; }
button { padding:6px 12px; margin:5px; cursor:pointer; position: relative; }
button:disabled { opacity: 0.5; cursor: not-allowed; }

/* Spinner ‡∏Å‡∏•‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ */
#spinner {
  border: 6px solid #f3f3f3;
  border-top: 6px solid #4CAF50;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 20px auto;
  display: none;
}

/* Spinner ‡πÄ‡∏•‡πá‡∏Å‡∏õ‡∏∏‡πà‡∏° */
button .btn-spinner {
  border: 3px solid #f3f3f3;
  border-top: 3px solid #fff;
  border-radius: 50%;
  width: 16px;
  height: 16px;
  animation: spin 1s linear infinite;
  position: absolute;
  top: 50%;
  left: 50%;
  margin: -8px 0 0 -8px;
  display: none;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
</head>
<body>
<h2>üí∞ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏á‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
<div id="spinner"></div>

<table id="dataTable">
  <thead>
    <tr>
      <th>
        ‡∏™‡∏≤‡∏Ç‡∏≤<br>
        <input type="text" class="filter" id="filterBranch" onkeyup="reloadWithFilter()">
      </th>
      <th>
        ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà<br>
        <input type="text" class="filter" id="filterDate" onkeyup="reloadWithFilter()">
      </th>
      <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
    </tr>
  </thead>
  <tbody id="tableBody">
    <tr><td colspan="3">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
  </tbody>
</table>

<div>
  <button id="prevBtn" onclick="prevPage()">
    ‚óÄ ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
    <div class="btn-spinner" id="prevSpinner"></div>
  </button>
  <span id="pageInfo">‡∏´‡∏ô‡πâ‡∏≤ 1</span>
  <button id="nextBtn" onclick="nextPage()">
    ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂
    <div class="btn-spinner" id="nextSpinner"></div>
  </button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwN_PCfE_zbJc4WuNn22e63eNsd4t3HkAeQuil9QdmcfbDpGP5L9oBru1_JuBfGyl-o6w/exec";
let currentPage = 0;
const pageSize = 20;
let totalRows = 0;

// Spinner ‡∏Å‡∏•‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤
function showSpinner(show) {
  document.getElementById("spinner").style.display = show ? "block" : "none";
}
// Spinner ‡∏õ‡∏∏‡πà‡∏°
function showBtnSpinner(btnId, show) {
  document.getElementById(btnId).style.display = show ? "block" : "none";
}

async function loadPage(page, btnSpinnerId=null) {
  const start = page * pageSize;
  const branch = document.getElementById("filterBranch").value || "";
  const date   = document.getElementById("filterDate").value || "";

  showSpinner(!btnSpinnerId);
  if (btnSpinnerId) showBtnSpinner(btnSpinnerId, true);

  try {
    const url = `${API_URL}?start=${start}&limit=${pageSize}&branch=${encodeURIComponent(branch)}&date=${encodeURIComponent(date)}`;
    const res = await fetch(url);
    const json = await res.json();
    totalRows = json.total;
    renderTable(json.data);
    updateButtons();
  } catch (err) {
    console.error(err);
    document.getElementById("tableBody").innerHTML = "<tr><td colspan='3'>‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</td></tr>";
  } finally {
    showSpinner(false);
    if (btnSpinnerId) showBtnSpinner(btnSpinnerId, false);
  }
}

function renderTable(data) {
  const tbody = document.getElementById("tableBody");
  if (!data || data.length === 0) {
    tbody.innerHTML = "<tr><td colspan='3'>‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>";
    document.getElementById("pageInfo").innerText = `‡∏´‡∏ô‡πâ‡∏≤ 0 / 0`;
    return;
  }

  tbody.innerHTML = data.map(row => `
    <tr>
      <td>${row.branch || "-"}</td>
      <td>${row.date || "-"}</td>
      <td>${row.time || "-"}</td>
    </tr>
  `).join("");

  document.getElementById("pageInfo").innerText = `‡∏´‡∏ô‡πâ‡∏≤ ${currentPage+1} / ${Math.ceil(totalRows/pageSize)}`;
}

function updateButtons() {
  document.getElementById("prevBtn").disabled = currentPage === 0;
  document.getElementById("nextBtn").disabled = (currentPage+1)*pageSize >= totalRows;
}

function nextPage() {
  if ((currentPage+1)*pageSize < totalRows) {
    currentPage++;
    loadPage(currentPage, "nextSpinner");
  }
}

function prevPage() {
  if (currentPage > 0) {
    currentPage--;
    loadPage(currentPage, "prevSpinner");
  }
}

// ‡∏Å‡∏£‡∏≠‡∏Å filter ‚Üí ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡πÉ‡∏´‡∏°‡πà
function reloadWithFilter() {
  currentPage = 0;
  loadPage(currentPage);
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
loadPage(currentPage);
</script>
</body>
</html>
