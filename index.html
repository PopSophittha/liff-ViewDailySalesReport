<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏á‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: sans-serif; padding:20px; background:#f9f9f9; text-align:center; }
h2 { margin-bottom:20px; }
table { border-collapse: collapse; width:100%; max-width:600px; margin:0 auto; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
th, td { border:1px solid #ddd; padding:8px 12px; text-align:center; }
th { background:#4CAF50; color:white; }
tr:nth-child(even) { background:#f2f2f2; }
button { padding:6px 12px; margin:5px; cursor:pointer; }

/* Spinner */
#spinner {
  border: 6px solid #f3f3f3;
  border-top: 6px solid #4CAF50;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 20px auto;
  display: none; /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏ô */
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
</head>
<body>
<h2>üí∞ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏á‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
<div id="spinner"></div>
<table id="dataTable">
  <tr><td>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
</table>
<div>
  <button id="prevBtn" onclick="prevPage()" disabled>‚óÄ ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
  <span id="pageInfo">‡∏´‡∏ô‡πâ‡∏≤ 1</span>
  <button id="nextBtn" onclick="nextPage()">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwN_PCfE_zbJc4WuNn22e63eNsd4t3HkAeQuil9QdmcfbDpGP5L9oBru1_JuBfGyl-o6w/exec";
let currentPage = 0;
const pageSize = 20;
let totalRows = 0;

function showSpinner(show) {
  document.getElementById("spinner").style.display = show ? "block" : "none";
}

async function loadPage(page) {
  const start = page * pageSize;
  showSpinner(true); // ‡πÅ‡∏™‡∏î‡∏á spinner
  try {
    const res = await fetch(`${API_URL}?start=${start}&limit=${pageSize}`);
    const json = await res.json();
    totalRows = json.total;
    renderTable(json.data);
    updateButtons();
  } catch (err) {
    console.error(err);
    document.getElementById("dataTable").innerHTML = "<tr><td>‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</td></tr>";
  } finally {
    showSpinner(false); // ‡∏ã‡πà‡∏≠‡∏ô spinner
  }
}

function renderTable(data) {
  const table = document.getElementById("dataTable");
  if (!data || data.length === 0) {
    table.innerHTML = "<tr><td>‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>";
    return;
  }

  let html = `<tr>
      <th>‡∏™‡∏≤‡∏Ç‡∏≤</th>
      <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
      <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
      <th>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
    </tr>`;

  data.forEach(row => {
    html += `<tr>
      <td>${row.branch || "-"}</td>
      <td>${row.date || "-"}</td>
      <td>${row.time || "-"}</td>
      <td>${row.staff || "-"}</td>
    </tr>`;
  });

  table.innerHTML = html;
  document.getElementById("pageInfo").innerText = `‡∏´‡∏ô‡πâ‡∏≤ ${currentPage+1} / ${Math.ceil(totalRows/pageSize)}`;
}

function updateButtons() {
  document.getElementById("prevBtn").disabled = currentPage === 0;
  document.getElementById("nextBtn").disabled = (currentPage+1)*pageSize >= totalRows;
}

function nextPage() {
  if ((currentPage+1)*pageSize < totalRows) {
    currentPage++;
    loadPage(currentPage);
  }
}

function prevPage() {
  if (currentPage > 0) {
    currentPage--;
    loadPage(currentPage);
  }
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
loadPage(currentPage);
</script>
</body>
</html>
